<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 范例使用的手工SQL语句 -->
<mapper namespace="balanceTrans">
	
	<select id="balanceTransPage" parameterType="Dto" resultType="Dto">
		SELECT
			t.id_,
			t.request_uuid_,
			t.summary_,
			t.transfer_amount_,
			ip.ip_address_ created_by_,
			t.created_time_,
			t.remark_,
			ta.transfer_id_,
			ta.position_,
			a.account_code_
		FROM
			as_trans_accounts ta,
			as_trans t,
			as_accounts a,
			fc_ip_white_list ip

		<where>
		ta.transfer_id_ = t.id_ and a.id_ = ta.account_id_ and ip.id_ = t.created_by_
		<if test="start_time_ != null and start_time_ !='' "> 
			AND t.created_time_ <![CDATA[ >= ]]> #{start_time_}  <!-- 开始日期 -->
		</if>
		
		<if test="end_time_ != null and end_time_ !='' ">
			AND t.created_time_ <![CDATA[ <= ]]> CONCAT(#{end_time_},' 23:59:59')  <!-- 结束日期 -->
		</if>
		
		
		<if test="little_amount_ != null and little_amount_ !='' "> 
			AND t.transfer_amount_ <![CDATA[ >= ]]> #{little_amount_}  <!-- 最小金额-->
		</if>
		
		<if test="big_amount_ != null and big_amount_ !='' ">
			AND t.transfer_amount_ <![CDATA[ <= ]]> #{big_amount_}  <!-- 最大金额-->
		</if>
		
		
		<if test="id_ != null and id_ != ''">
			AND t.id_= #{id_}
		</if>
		
		<if test="summary_ != null and summary_ != ''">
			AND t.summary_ = #{summary_}
		</if>
		
		<if test="involve_type_ != null and involve_type_ != ''">
			AND ta.involve_type_ = #{involve_type_}
		</if>

		<if test="account_code_ != null and account_code_ != ''">
			AND a.account_code_ = #{account_code_}
		</if>

		<if test="request_uuid_ != null and request_uuid_ != ''">
			AND t.request_uuid_ = #{request_uuid_}
		</if>	
		group by ta.transfer_id_
		order by t.id_ desc  
		
		</where> 
			
	</select>
	
	
	<select id="transAccountsDetailsPage" parameterType="Dto" resultType="Dto">
		SELECT
			ta.id_ as trans_accounts_id_,
			ta.transfer_id_,
			ta.account_id_,
			ta.amount_,
			ta.position_,
			ta.involve_reason_,
			ta.involve_type_,
			a.account_code_,
			bs.id_ as snapshot_id_
		FROM
			as_trans_accounts ta,
			as_accounts a,
			as_balance_snapshot bs
			
		WHERE	
			ta.account_id_ =a.id_ and ta.id_ = bs.origin_id_
		<if test="transfer_id_ != null and transfer_id_ != ''">
			AND ta.transfer_id_ = #{transfer_id_}
		</if>
		<if test="involve_type_ != null and involve_type_ != ''">
			AND ta.involve_type_ = #{involve_type_}
		</if>
 	
	</select>
	
	
	
	<select id="balanceSnapshotDetail" parameterType="Dto" resultType="Dto">
		SELECT
			fc.name_,
			fc.idcard_,
			fc.customer_code_,
			fc.cellphone_,
			bs.id_,
			bs.reason_,
			bs.origin_id_,
			bs.created_time_,
			a.account_code_
		FROM
			as_balance_snapshot bs,
			as_accounts a,
			fc_customer fc
		WHERE	
			bs.account_id_ =a.id_ and fc.id_ = a.customer_id_
		<if test="snapshot_id_ != null and snapshot_id_ != ''">
			AND bs.id_ = #{snapshot_id_}
		</if>
			<if test="origin_id_ != null and origin_id_ != ''">
			AND bs.origin_id_ = #{origin_id_}
		</if>
			<if test="reason_ != null and reason_ != ''">
			AND bs.reason_ = #{reason_}
		</if>
	</select>
	
	
	<select id="companyBalanceSnapshotDetail" parameterType="Dto" resultType="Dto">
		SELECT
			bs.id_,
			bs.reason_,
			bs.origin_id_,
			bs.created_time_,
			a.account_code_
		FROM
			as_balance_snapshot bs,
			as_accounts a
		WHERE	
			bs.account_id_ =a.id_ 
		<if test="snapshot_id_ != null and snapshot_id_ != ''">
			AND bs.id_ = #{snapshot_id_}
		</if>
			<if test="origin_id_ != null and origin_id_ != ''">
			AND bs.origin_id_ = #{origin_id_}
		</if>
			<if test="reason_ != null and reason_ != ''">
			AND bs.reason_ = #{reason_}
		</if>
	</select>
	
	
</mapper>