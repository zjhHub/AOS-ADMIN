<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="inlandMoving">

	<!-- 查询务线下的账户 -->
	<select id="getAccountInlandMovingList" parameterType="Dto" resultType="Dto">
		SELECT
			bit.id_ as inside_trans_id,
			bit.type_ as type,
			bit.time_ as time,
			bit.amount_ as amount,
			bit.out_ as out_position,
			bit.in_ as in_position,
			
			bs.available_balance_before_,
			bs.available_balance_after_,
			bs.froze_balance_before_,
			bs.froze_balance_after_	
		FROM
			as_accounts a,
			as_balance_snapshot bs,
			as_account_balance_inside_trans bit		
		WHERE
			bs.id_ = bit.snapshot_id_ AND a.id_ = bit.account_id_ 
			
			<if test="account_code != null and account_code != ''">
				AND a.account_code_ =#{account_code}
			</if>		
			<if test="type != null and type != ''">
				AND bit.type_ = #{type}
			</if>			
			<if test="amount_end != null and amount_end != ''">
				AND bit.amount_ <![CDATA[ <= ]]> #{amount_end}
			</if>
			<if test="amount_start != null and amount_start != ''">
				AND bit.amount_ <![CDATA[ >= ]]> #{amount_start}
			</if>
			<if test="recode_time_end != null and recode_time_end != ''">
				AND bit.time_ <![CDATA[ <= ]]> #{recode_time_end}
			</if>		
			<if test="recode_time_start != null and recode_time_start != ''">
				AND bit.time_ <![CDATA[ >= ]]> #{recode_time_start}
			</if>
			limit #{beginIndex}, #{page_size}
	</select>

	<select id="getAccountInlandMovingCount" parameterType="Dto" resultType="Dto">
		SELECT
			count(1) as count
		FROM
			as_accounts a,
			as_balance_snapshot bs,
			as_account_balance_inside_trans bit		
		WHERE
			bs.id_ = bit.snapshot_id_ AND a.id_ = bit.account_id_ 
			
			<if test="account_code != null and account_code != ''">
				AND a.account_code_ =#{account_code}
			</if>		
			<if test="type != null and type != ''">
				AND bit.type_ = #{type}
			</if>			
			<if test="amount_end != null and amount_end != ''">
				AND bit.amount_ <![CDATA[ <= ]]> #{amount_end}
			</if>
			<if test="amount_start != null and amount_start != ''">
				AND bit.amount_ <![CDATA[ >= ]]> #{amount_start}
			</if>
			<if test="recode_time_end != null and recode_time_end != ''">
				AND bit.time_ <![CDATA[ <= ]]> #{recode_time_end}
			</if>		
			<if test="recode_time_start != null and recode_time_start != ''">
				AND bit.time_ <![CDATA[ >= ]]> #{recode_time_start}
			</if>
	</select>

</mapper>