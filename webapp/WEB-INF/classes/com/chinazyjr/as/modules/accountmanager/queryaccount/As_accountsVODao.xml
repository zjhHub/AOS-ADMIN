<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- as_accounts[as_accounts]SQL自动映射 -->
<!--  注意:此文件由AOS平台自动生成-禁止手工修改 2017-03-15 15:17:02 -->
<mapper namespace="com.chinazyjr.as.modules.accountmanager.queryaccount.As_accountsVODao">
	<!-- 查询客户开设的账户集 -->
	<select id="queryAccount" parameterType="Dto" resultType="As_accountsVO">
		select account.account_code_,account.purpose_,account.status_,account.create_time_,
		account.ext_reference_,platform.name_ attach_platform_,account.type_ from as_accounts account 
		join fc_customer customer on account.customer_id_=customer.id_
		join fc_platform platform on platform.id_=account.attach_platform_ where 1=1 
		<if test="attach_platform != null and attach_platform != ''">
		      AND account.attach_platform_ = #{attach_platform}  <!-- attach_platform_ -->
		</if>
	   <if test="customer_idcard != null ">
		      AND customer.idcard_ = #{customer_idcard}  <!-- customer_idcard -->
		</if>
	    <if test="purpose != null and purpose != ''">
		      AND account.purpose_ = #{purpose}  <!-- purpose_ -->
		</if>
	    <if test="ext_reference != null and ext_reference != ''">
		      AND account.ext_reference_ = #{ext_reference}  <!-- type_ -->
		</if>
	    <if test="status != null and status != ''">
		      AND account.status_ = #{status}  <!-- status_ -->
		</if>
		<if test="type != null and type != ''">
		      AND account.type_ = #{type}  <!-- status_ -->
		</if>	
	</select>
	
	<!-- 查询客户单个账户 -->
	<select id="querySingleAccount" parameterType="Dto" resultType="As_accountsVO">
		select account.account_code_,account.purpose_,account.status_,account.create_time_,
		account.ext_reference_,platform.name_ attach_platform_,customer.idcard_ from as_accounts account 
		join fc_customer customer on account.customer_id_=customer.id_
		join fc_platform platform on platform.id_=account.attach_platform_ where account.account_code_ =#{account_code} 
	</select>
	
	<!-- 冻结解冻操作更新账户金额信息 -->
	<update id="updateAccountInfoForAmountFreeze" parameterType="Dto">
		update as_accounts set available_balance_=#{available_balance_},froze_balance_=#{froze_balance_},
		data_version_=data_version_+1,update_time_=#{update_time_},sn_ =MD5(concat(#{sn_},available_balance_,froze_balance_,total_balance_,update_time_))  
		where data_version_=#{data_version_} and id_=#{id_} and sn_ = MD5(concat(#{sn_},available_balance_,froze_balance_,total_balance_,update_time_))
	</update>
	
</mapper>